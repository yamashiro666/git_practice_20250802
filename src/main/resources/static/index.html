<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TCP/UDP Server Admin</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; }
    .row { display: flex; gap: .5rem; align-items: center; flex-wrap: wrap; }
    label { min-width: 40px; }
    input { padding: .4rem .6rem; }
    button { padding: .5rem .9rem; cursor: pointer; }
    .ok { color: #0a7; }
    .ng { color: #c33; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
  </style>
</head>
<body>
  <h1>TCP/UDP Server Admin</h1>

  <div class="card">
    <h2>TCP</h2>
    <div class="row">
        <label>TCP 名称: <input id="tcpName" placeholder="TCP Server"></label>
        <label>TCP IP:   <input id="tcpIp"   value="127.0.0.1"></label>
        <label>TCP Port: <input id="tcpPort" type="number" value="5000"></label>
        <button id="tcpStart">TCP Start</button>
    </div>
  </div>

  <div class="card">
    <h2>UDP</h2>
    <div class="row">
        <label>UDP 名称: <input id="udpName" placeholder="UDP Server"></label>
        <label>UDP IP:   <input id="udpIp"   value="127.0.0.1"></label>
        <label>UDP Port: <input id="udpPort" type="number" value="5001"></label>
        <button id="udpStart">UDP Start</button>
    </div>
  </div>

  <div class="card">
    <h2>Status</h2>
    <pre id="status" class="mono">loading...</pre>
  </div>

<script>
  const statusEl = document.getElementById('status');

  async function postJson(url, body) {
    const r = await fetch(url, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    if (!r.ok) throw new Error('HTTP ' + r.status);
    return r.json().catch(()=> ({}));
  }

  document.getElementById('tcpStart').onclick = async () => {
    await postJson('/api/server/tcp/start', {
      name: document.getElementById('tcpName').value,
      ip:   document.getElementById('tcpIp').value,
      port: Number(document.getElementById('tcpPort').value)
    });
    await refresh();
  };

  document.getElementById('udpStart').onclick = async () => {
    await postJson('/api/server/udp/start', {
      name: document.getElementById('udpName').value,
      ip:   document.getElementById('udpIp').value,
      port: Number(document.getElementById('udpPort').value)
    });
    await refresh();
  };

  async function refresh() {
    try {
      statusEl.textContent = 'loading...';
      const r = await fetch('/api/server/status');
      if (!r.ok) throw new Error('HTTP ' + r.status);
      const s = await r.json();

      // そのままJSON表示
      statusEl.textContent = JSON.stringify(s, null, 2);

      // 必要なら整形表示例（コメントアウトを外して使う）
      // statusEl.textContent =
      //   `TCP: running=${s.tcp.running} name="${s.tcp.name}"` +
      //   (s.tcp.port ? ` port=${s.tcp.port}` : '') + '\n' +
      //   `UDP: running=${s.udp.running} name="${s.udp.name}"` +
      //   (s.udp.port ? ` port=${s.udp.port}` : '');
    } catch (e) {
      statusEl.textContent = 'error: ' + e.message;
    }
  }

  refresh();
  setInterval(refresh, 3000);
</script>
</body>
</html>